---
title: 'CH11-Testing Overview'
description: 測試概述
---

## TL;DR 內容提要

- 自動化測試是實現軟體變革的基礎。

- 為了使測試規模化，它們必須是自動化的。

- 平衡的測試套件對於保持健康的測試覆蓋率是必要的。

- 如果你喜歡它，你應該對它進行測試。

- 改變團隊中的測試文化需要時間。

## Why Do We Write Tests? 為什麼我們要寫測試？

當我們談論自動化測試時，我們真正談論的是什麼？

最簡單的測試定義如下：

- 你要測試的單一行為，通常是你要呼叫的一個方法或API
- 一個特定的輸入，你傳遞給API的一些值
- 可觀察的輸出或行為
- 受控的環境，如一個單獨的隔離進程(process)

當你執行這樣的測試時，將輸入傳給系統並驗證輸出，你將瞭解到系統是否期望執行，更重要的是，何時不符合預期設計。

### Benefits of Testing Code 測試程式碼的好處

對於來自沒有測試文化團隊的開發者來說，把編寫測試作為提高生產力和速度的手段的想法可能看起來是對立的。畢竟，編寫測試所需的時間可能與實現功能所需的時間一樣長。相反，在 Google，我們發現投入於軟體測試對開發人員的生產力有幾個關鍵的好處：

- 更少的除錯(_Less debugging_)
  > 正如你所期望的那樣，經過測試的程式碼在提交時有更少的缺陷。重要的是，它在整個存在過程中也有較少的缺陷；大多數缺陷在程式碼提交之前就會被發現。在 Google，一段程式碼在其生命週期內預計會被修改幾十次。它將被其他團隊甚至是自動程式碼維護系統所改變。一次寫好的測試會繼續帶來紅利，並在專案的生命週期中防止昂貴的缺陷和惱人的除錯過程。對專案或專案的依賴關係的改變，如果破壞了測試，可以被測試基礎設施迅速發現，並在問題被發布到正式環境之前回滾(rollback)。
- 在變更中增加了信心(_Increased confidence in changes_)
  > 具有良好測試的團隊可以滿懷信心地審查和接受專案的變更，因為他們的專案的所有重要行為都得到了持續驗證。這樣的專案鼓勵重構。在保留現有行為的情況下，重構程式碼的變化理論上不需要改變現有的測試。
- 改進文件(_Improved documentation_)
  > 軟體文件是出了名的不可靠。從過時的需求到缺失的邊緣案例，文件與程式碼的關係很脆弱，這很正常。如果你想知道程式碼在某一特定情況下做了什麼，看看該情況的測試。更好的是，當需求發生變化，新的程式碼破壞了現有的測試時，我們會得到一個明確的訊號，"文件"現在已經過時了。請注意，只有在保持測試的清晰和簡潔的情況下，測試才能作為文件發揮最佳效果。
- 簡單審查(_Simpler reviews_)
  > 在 Google，所有的程式碼在提交之前都要經過至少一名其他工程師的審查。如果程式碼審查包括徹底的測試，證明程式碼的正確性、邊緣情況和錯誤情況，那麼程式碼審查員會懶得驗證程式碼是否按預期執行。而現在有自動化測試，審查員可以輕鬆驗證每個案例都有一個合格的測試，而不必費心費力地在程式碼中對每個案例進行手動測試。
- 深思熟慮設計(_Thoughtful design_)
  > 為新程式碼編寫測試是鍛鍊程式碼本身的 API 設計的一種實用手段。如果新程式碼難以測試，往往是因為被測試的程式碼做了太多事情或有難以管理的依賴關係。設計良好的程式碼應該是模組化的，避免緊密耦合，並專注於特定的責任。儘早修復設計問題往往意味著降低以後回來修復或調整的機率。
- 快速、高品質的釋出(_Fast, high-quality releases_)
  > 有了健康的自動化測試套件，團隊可以放心地釋出新版本的應用程式。Google 的許多專案每天都會向生產部門釋出一個新的版本--即使是有數百名工程師的大型專案，每天都會提交成千上萬的程式碼修改。如果沒有自動化測試，這是不可能做到的。

### Test Scope 測試範圍

書中建議的測試比例是 E2E(5%) & Integration(15%) & Unit(80%)，請依照實際情況調整比例向建議比例靠攏，這個比例可以在專案早期傾向單元測試，可以迅速獲得信心，而大型測試通常僅作為參考而不是尋找 bug 的主要方法。

![測試金字塔](https://software-engineering-at-google.gh.miniasp.com/zh-cn/Chapter-11_Testing_Overview/images/image-20220407200917862.png)

另外如果發現處於兩種反模式的情況則需重視相對應的問題

- 冰淇淋筒型，通常整個專案的測試會偏慢且不可靠，這種模式常出現於急於上線而從沒有回頭解決測試債的專案
- 沙漏型，這類型比冰淇淋桶型好不了多少，通常代表專案的單元過於耦合，難以單獨實例化，因此難以進行整合測試

![反模式](https://software-engineering-at-google.gh.miniasp.com/zh-cn/Chapter-11_Testing_Overview/images/image-20220407201117705.png)

### The Beyoncé Rule 碧昂斯規則

測試所有你不想破壞的東西，如果你想確定系統會表現出一個特定行為，唯一能確保它總是會表現出這種行為的方法就是為它編寫一個自動測試。

簡言之，"如果你喜歡它，那麼你就應該對它進行測試"。

## History of Testing at Google - Google 的測試歷史

儘管 Google 早期的工程人員大多回避測試，但 Google 自動化測試的工程師們知道，按照公司的發展速度，新加入的工程師會很快超過現有的團隊成員。如果他們能接觸到公司所有的新員工，這可能是一個引入文化變革的極其有效的途徑。幸運的是，所有新的工程人員都要經歷一個節點：入職培訓。

當新鮮的 Noogler 加入他們的團隊後，他們開始寫測試，並質疑團隊中那些沒有寫的人。在短短的一兩年內，接受過測試教學的工程師人數超過了以往的工程師。因此，許多新專案一開始就很順利。

### Testing on the Toilet 廁所測試

測試小組曾用來提高整個公司的測試意識的方法之一，一開始他們考慮發電子郵件通知，但考慮到可能會沉沒在信箱底部，此時有人開玩笑地提出在洗手間的隔間裡張貼海報的想法。他們很快就認識到了其中的天才之處：無論如何，衛生間是每個人每天至少要去一次的地方。不管是不是玩笑，這個想法實施起來很簡單，所以必須嘗試一下。

2006 年 4 月，一篇涵蓋如何改進 Python 測試的短文出現在整個 Google 的洗手間裡。反應很兩極，但不管怎樣測試小組都很滿意，因為他們都在討論測試。

有興趣的話可以看看，[Google 測試刊物](https://testing.googleblog.com/search/label/TotT)。

### The Limits of Automated Testing 自動化測試的侷限

自動測試並不適合所有的測試任務。例如，測試搜尋結果的品質通常需要人工判斷。我們使用搜索品質評測員進行有針對性的內部研究，他們執行真實的查詢並記錄他們的印象。同樣，在自動測試中很難捕捉到音訊和影片品質的細微差別，所以我們經常使用人工判斷來評估電話或視訊通話系統的效能。

除了定性判斷外，還有一些人擅長的創造性評估。例如，搜尋複雜的安全漏洞是人工比自動化系統做得更好的事情。在人類發現並理解了一個漏洞之後，它可以被新增到一個自動化的安全測試系統中，比如 Google 的雲安全掃描，在那裡它可以被連續和大規模地執行。

這種技術的一個更概括的術語是探索性測試。探索性測試從根本上說是一種創造性的工作，有人將被測試的應用程式視為一個有待破解的難題，也許是透過執行一組意想不到的步驟或插入預料之外的資料。在進行探索性測試時，要發現的具體問題在開始時是未知的。它們是透過探測通常被忽視的程式碼路徑或來自應用程式的不尋常的反應而逐漸發現的。與安全漏洞的檢測一樣，一旦探索性測試發現了問題，應新增自動測試以防止將來出現倒退。

透過使用自動化測試來覆蓋被充分理解的行為，測試人員可以將昂貴的定性工作重點放在產品中他們可以提供最大價值的部分，並避免在這個過程中使他們感到無聊。
