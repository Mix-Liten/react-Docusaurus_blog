---
title: 'CH09-Code Review'
description: 程式碼審查
---

## 前言

程式碼審查是一個由作者以外的人對程式碼進行審查的過程，通常在將該程式碼引入程式碼庫之前。儘管這是一個簡單的定義，但在整個軟體行業中，程式碼審查的實際運作方式多有不同。在 Google，基本上每一個改動在提交之前都會被審查，每個工程師都可以負責審查和檢視修改。

## Code Review Flow 程式碼審查過程

Google 典型程式碼審查過程，經由個人理解及替換內部審查工具後，比較能被參考的過程如下：

1. 假設你已建立個人工作區(git branch)，並做了一些程式修改。建立變更的快照(git commit)，內含程式修改前後的差異(git diff)及相應的描述(git commit message)，用於評估已更改的程式碼。
2. 你可以先自行檢查一下是否滿意這個 patch，沒問題的話，自行經由電子郵件或平台(GitHub、Bitbucket)功能通知一個或多個審查者。此過程通知這些審查者(reviewers)，要求他們檢視快照並對其進行評論。
3. 審查者審閱程式碼的差異，並對此發表評論(comment)。評論可以具體明確的要求修改，也可以只是留下提示性的資訊。
4. 根據反饋意見修改，並上傳新的快照，然後留言標示(tag)並回覆給審查者。步驟 3 和 4 可重複多次。
5. 在審查員對變更的最新狀態感到滿意後，他們同意變更，並透過將其標記為“LGTM”（我覺得不錯）來接受變更。一般可能規定要所有審查者同意，但實務上通常只需要至少一個 LGTM 即可。
6. 在快照中有 LGTM 標記且確保解決所有評論之後，現在可以將更改提交到程式碼庫(Pull Request)，並等待變更被批准(Approve)。

在最後一步的等待批准的過程中，仍然有三個方面需要被檢查：

1. 正確性和可讀性檢查，檢查程式碼是否合適，以及程式碼是否符合作者宣稱的事情。通常是由同個團隊的成員進行，但也有例外。
2. 需要專案主要負責人的同意，雖然任何人都能參與審查並提出意見，但最終合併修改進主分支時必須由主負責人把關。這個負責人通常是經由團隊認可的技術擔當或特定技術的專家。
3. 通過負責全公司程式碼規範團隊的認可。Google 裡有一個專門負責保證程式碼品質的團隊，他們保證了全公司所有專案、所有程式語言的規範，確保程式的可讀性、最佳實踐。

不可否認，有時候只有一個人審查。注意，即使你自己就是專案負責人，足以保證大部分的環節，但為符合業界標準，仍需最少一個其他工程師來承擔標記 LGTM 的步驟。

## Code Review Benefits 程式碼審查的好處

一個精心設計的程式碼審查過程和認真對待程式碼審查的文化會帶來以下好處：

- 檢查程式碼的正確性(_Code Correctness_)
- 確保其他工程師能夠理解程式碼更改(_Comprehension of Code_)
- 強化整個程式碼庫的一致性(_Code Consistency_)
- 從心理上促進團隊的所有權(_Psychological and Cultural Benefits_)
  > 重要的文化好處：它向軟體工程師強調程式碼不是“他們的”，而是事實上集體事業的一部分。這種心理上的好處可能很微妙，但仍然很重要。沒有程式碼審查，大多數工程師自然會傾向於個人風格和他們自己的軟體設計方法。程式碼審查過程迫使作者不僅要向別人提出意見，而且要為了更大的利益做出妥協。
- 實現知識共享
- 提供程式碼審查本身的歷史記錄

## Code Review Best Practices 程式碼評審最佳實踐

- Be Polite and Professional 要有禮貌和專業精神
- Write Small Changes 寫出小的更改
  > 不強迫，小改動建議在兩百行以內，漸進式的小規模改動比較容易審查，也可以更快的加速過程。
- Write Good Change Descriptions 寫出好的變更描述
  > 參考套件 [git-cz](https://github.com/streamich/git-cz)，理應在描述第一行註明`變更的類型`及`變更的主要描述`以作為一個可以被當作信件標題的摘要，而不是只是“Bug fix”的無意義訊息。後續描述仍應留下盡量多的說明，如果審查者不明白你為什麼要這麼做，即使程式碼是正確的，也可以當作一個指標來看待，並因此留下適當的註解，這是你為後繼者所做的紀錄。
- Keep Reviewers to a Minimum 儘量減少審查員
  > 在 Google，大多數的程式碼審查都是由一個審查員進行。由於程式碼審查過程允許由一個人處理程式碼正確性、所有者接受度和語言可讀性等方面的問題，程式碼審查過程在 Google 這樣的團隊規模中仍具有相當好的擴充性。
- Automate Where Possible 儘可能實現自動化
  > 程式碼評審是一個人工過程，人的投入很重要，但是如果程式碼過程中的某些部分可以自動化，就儘量這樣做。
